<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>app.views &#8212; SciQuest  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=12dfc556" />
    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for app.views</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">app.models</span> <span class="kn">import</span> <span class="n">Article</span><span class="p">,</span><span class="n">UserFavorite</span>
<span class="kn">from</span> <span class="nn">elasticsearch_dsl</span> <span class="kn">import</span> <span class="n">Search</span>
<span class="kn">from</span> <span class="nn">.index</span> <span class="kn">import</span> <span class="n">ArticleIndex</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span><span class="p">,</span> <span class="n">HttpResponseServerError</span><span class="p">,</span><span class="n">JsonResponse</span>
<span class="kn">from</span> <span class="nn">elasticsearch.helpers</span> <span class="kn">import</span> <span class="n">bulk</span>
<span class="kn">from</span> <span class="nn">tenacity</span> <span class="kn">import</span> <span class="n">retry</span><span class="p">,</span> <span class="n">stop_after_delay</span><span class="p">,</span> <span class="n">wait_fixed</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">get_object_or_404</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">django.views.decorators.csrf</span> <span class="kn">import</span> <span class="n">csrf_exempt</span>
<span class="kn">from</span> <span class="nn">authentication.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>
<span class="kn">from</span> <span class="nn">elasticsearch_dsl.connections</span> <span class="kn">import</span> <span class="n">connections</span>


<div class="viewcode-block" id="index_articles">
<a class="viewcode-back" href="../../docs/app.html#app.views.index_articles">[docs]</a>
<span class="nd">@csrf_exempt</span>
<span class="k">def</span> <span class="nf">index_articles</span><span class="p">(</span><span class="n">article</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    View function to index an article in Elasticsearch.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        - article: The article to be indexed.</span>

<span class="sd">    Response:</span>
<span class="sd">        - JSON response indicating the status of the indexing.</span>

<span class="sd">    Raises:</span>
<span class="sd">        - Exception: If an error occurs during indexing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Check if the article has an ID</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">article</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Article has no ID&#39;</span><span class="p">})</span>

        <span class="c1"># Define actions for bulk indexing</span>
        <span class="n">actions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;_op_type&quot;</span><span class="p">:</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span>
                <span class="s2">&quot;_index&quot;</span><span class="p">:</span> <span class="s2">&quot;article_index&quot;</span><span class="p">,</span>
                <span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="n">article</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="s2">&quot;_source&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">article</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
                    <span class="s2">&quot;abstract&quot;</span><span class="p">:</span> <span class="n">article</span><span class="o">.</span><span class="n">abstract</span><span class="p">,</span>
                    <span class="s2">&quot;authors&quot;</span><span class="p">:</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">author</span><span class="p">)</span> <span class="k">for</span> <span class="n">author</span> <span class="ow">in</span> <span class="n">article</span><span class="o">.</span><span class="n">authors</span><span class="o">.</span><span class="n">all</span><span class="p">()),</span>
                    <span class="s2">&quot;institutions&quot;</span><span class="p">:</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">institution</span><span class="p">)</span> <span class="k">for</span> <span class="n">institution</span> <span class="ow">in</span> <span class="n">article</span><span class="o">.</span><span class="n">institutions</span><span class="o">.</span><span class="n">all</span><span class="p">()),</span>
                    <span class="s2">&quot;keywords&quot;</span><span class="p">:</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span> <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">article</span><span class="o">.</span><span class="n">keywords</span><span class="o">.</span><span class="n">all</span><span class="p">()),</span>
                    <span class="s2">&quot;references&quot;</span><span class="p">:</span> <span class="n">article</span><span class="o">.</span><span class="n">references</span><span class="p">,</span>
                    <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">article</span><span class="o">.</span><span class="n">full_text</span><span class="p">,</span>
                    <span class="s2">&quot;pdf_url&quot;</span><span class="p">:</span> <span class="n">article</span><span class="o">.</span><span class="n">pdf_url</span><span class="p">,</span>
                    <span class="s2">&quot;validated&quot;</span><span class="p">:</span> <span class="n">article</span><span class="o">.</span><span class="n">validated</span><span class="p">,</span>
                    <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="n">article</span><span class="o">.</span><span class="n">date</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">]</span>

        <span class="c1"># Get Elasticsearch connection and perform bulk indexing</span>
        <span class="n">es</span> <span class="o">=</span> <span class="n">ArticleIndex</span><span class="o">.</span><span class="n">_get_connection</span><span class="p">()</span>
        <span class="n">success</span><span class="p">,</span> <span class="n">failed</span> <span class="o">=</span> <span class="n">bulk</span><span class="p">(</span><span class="n">client</span><span class="o">=</span><span class="n">es</span><span class="p">,</span> <span class="n">actions</span><span class="o">=</span><span class="n">actions</span><span class="p">,</span> <span class="n">stats_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Return JSON response based on indexing success or failure</span>
        <span class="k">if</span> <span class="n">failed</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Article indexed successfully&#39;</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Failed to index article. </span><span class="si">{</span><span class="n">failed</span><span class="si">}</span><span class="s1"> actions failed&#39;</span><span class="p">})</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># Return JSON response with an error message if an exception occurs</span>
        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Error during indexing: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">})</span></div>


<span class="c1">#--------------------------------------------------------------</span>
    
<div class="viewcode-block" id="search_articles">
<a class="viewcode-back" href="../../docs/app.html#app.views.search_articles">[docs]</a>
<span class="nd">@csrf_exempt</span>
<span class="k">def</span> <span class="nf">search_articles</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    View function to perform a search on articles using Elasticsearch.</span>

<span class="sd">    Request:</span>
<span class="sd">        - POST request with JSON data containing &#39;query&#39;.</span>

<span class="sd">    Response:</span>
<span class="sd">        - JSON response with search result data.</span>

<span class="sd">    Raises:</span>
<span class="sd">        - Exception: If an error occurs during the search.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Retrieve JSON data from the request body</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;query&#39;</span><span class="p">)</span>

            <span class="c1"># Perform Elasticsearch search with retry mechanism</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">perform_elasticsearch_search1</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

            <span class="n">hits_data</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Move the list declaration outside the loop</span>

            <span class="c1"># Extract and print search results in the console</span>
            <span class="k">for</span> <span class="n">hit</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="c1"># Check if &#39;validated&#39; is True</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="s1">&#39;validated&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
                    <span class="n">title</span> <span class="o">=</span> <span class="n">hit</span><span class="o">.</span><span class="n">title</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
                    <span class="n">authors</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hit</span><span class="o">.</span><span class="n">authors</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="s1">&#39;authors&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="p">[])</span>
                    <span class="n">institutions</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hit</span><span class="o">.</span><span class="n">institutions</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="s1">&#39;institutions&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="p">[])</span>
                    <span class="n">keywords</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hit</span><span class="o">.</span><span class="n">keywords</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="s1">&#39;keywords&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="p">[])</span>
                    <span class="n">abstract</span> <span class="o">=</span> <span class="n">hit</span><span class="o">.</span><span class="n">abstract</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="s1">&#39;abstract&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
                    <span class="n">references</span> <span class="o">=</span> <span class="n">hit</span><span class="o">.</span><span class="n">references</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="s1">&#39;references&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="n">hit</span><span class="o">.</span><span class="n">text</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
                    <span class="n">date</span> <span class="o">=</span> <span class="n">hit</span><span class="o">.</span><span class="n">date</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;2024-10-12&#39;</span>
                    <span class="nb">id</span> <span class="o">=</span> <span class="n">hit</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">id</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="s1">&#39;meta&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">hit</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>

                    <span class="c1"># Print search results in the console</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Title: </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Authors: </span><span class="si">{</span><span class="n">authors</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Institutions: </span><span class="si">{</span><span class="n">institutions</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Keywords: </span><span class="si">{</span><span class="n">keywords</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Abstract: </span><span class="si">{</span><span class="n">abstract</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;References: </span><span class="si">{</span><span class="n">references</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Text: </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Date: </span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ID: </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="c1"># Append data to the list</span>
                    <span class="n">hits_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
                        <span class="s1">&#39;authors&#39;</span><span class="p">:</span> <span class="n">authors</span><span class="p">,</span>
                        <span class="s1">&#39;institutions&#39;</span><span class="p">:</span> <span class="n">institutions</span><span class="p">,</span>
                        <span class="s1">&#39;keywords&#39;</span><span class="p">:</span> <span class="n">keywords</span><span class="p">,</span>
                        <span class="s1">&#39;abstract&#39;</span><span class="p">:</span> <span class="n">abstract</span><span class="p">,</span>
                        <span class="s1">&#39;references&#39;</span><span class="p">:</span> <span class="n">references</span><span class="p">,</span>
                        <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="n">text</span><span class="p">,</span>
                        <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">date</span><span class="p">,</span>
                        <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="nb">id</span>
                    <span class="p">})</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Not validated&#39;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s1">&#39;result&#39;</span><span class="p">:</span> <span class="n">hits_data</span><span class="p">})</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Return JSON response with an error message if an exception occurs</span>
            <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Error during research: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;This view only accepts POST requests.&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="perform_elasticsearch_search1">
<a class="viewcode-back" href="../../docs/app.html#app.views.perform_elasticsearch_search1">[docs]</a>
<span class="nd">@retry</span><span class="p">(</span><span class="n">stop</span><span class="o">=</span><span class="n">stop_after_delay</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span> <span class="n">wait</span><span class="o">=</span><span class="n">wait_fixed</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">perform_elasticsearch_search1</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retry decorator applied to an Elasticsearch search function.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        - query (str): The search query.</span>

<span class="sd">    Returns:</span>
<span class="sd">        - response: Elasticsearch search response.</span>

<span class="sd">    Raises:</span>
<span class="sd">        - Exception: If the Elasticsearch search fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Use Elasticsearch DSL to perform the search</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">Search</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;article_index&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
        <span class="s1">&#39;bool&#39;</span><span class="p">,</span>
        <span class="n">should</span><span class="o">=</span><span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;match&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">query</span><span class="p">}},</span>
            <span class="p">{</span><span class="s2">&quot;match&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;abstract&quot;</span><span class="p">:</span> <span class="n">query</span><span class="p">}},</span>
            <span class="p">{</span><span class="s2">&quot;match&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;authors&quot;</span><span class="p">:</span> <span class="n">query</span><span class="p">}},</span>
            <span class="p">{</span><span class="s2">&quot;match&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;institutions&quot;</span><span class="p">:</span> <span class="n">query</span><span class="p">}},</span>
            <span class="p">{</span><span class="s2">&quot;match&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;keywords&quot;</span><span class="p">:</span> <span class="n">query</span><span class="p">}},</span>
            <span class="p">{</span><span class="s2">&quot;match&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">query</span><span class="p">}},</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">extra</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

    <span class="c1"># Check if the search was successful</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">success</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">response</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Elasticsearch search failed&quot;</span><span class="p">)</span></div>

      
<span class="c1">#--------------------------------------------------------------</span>
<div class="viewcode-block" id="add_to_favorites">
<a class="viewcode-back" href="../../docs/app.html#app.views.add_to_favorites">[docs]</a>
<span class="nd">@csrf_exempt</span>
<span class="k">def</span> <span class="nf">add_to_favorites</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    View function to add an article to a user&#39;s favorites.</span>

<span class="sd">    Request:</span>
<span class="sd">        - POST request with JSON data containing &#39;user_id&#39; and &#39;article_id&#39;.</span>

<span class="sd">    Response:</span>
<span class="sd">        - JSON response indicating the status of the addition.</span>

<span class="sd">    Raises:</span>
<span class="sd">        - Exception: If an error occurs during the processing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Extract user and article IDs from the JSON data in the request body</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">)</span>
        <span class="n">article_id</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;article_id&#39;</span><span class="p">)</span>

        <span class="c1"># Check if the user already has the article in favorites</span>
        <span class="k">if</span> <span class="n">UserFavorite</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span> <span class="n">article_id</span><span class="o">=</span><span class="n">article_id</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;Already in favorites&#39;</span><span class="p">})</span>

        <span class="c1"># If not, add the article to favorites</span>
        <span class="n">user_favorite</span> <span class="o">=</span> <span class="n">UserFavorite</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span> <span class="n">article_id</span><span class="o">=</span><span class="n">article_id</span><span class="p">)</span>
        <span class="n">user_favorite</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;Added to favorites&#39;</span><span class="p">})</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># Return JSON response with an error message if an exception occurs</span>
        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)})</span></div>


<span class="c1">#---------------------------------------------------------------------</span>
        
<div class="viewcode-block" id="delete_from_favorites">
<a class="viewcode-back" href="../../docs/app.html#app.views.delete_from_favorites">[docs]</a>
<span class="nd">@csrf_exempt</span>
<span class="k">def</span> <span class="nf">delete_from_favorites</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    View function to remove an article from a user&#39;s favorites.</span>

<span class="sd">    Request:</span>
<span class="sd">        - POST request with JSON data containing &#39;user_id&#39; and &#39;article_id&#39;.</span>

<span class="sd">    Response:</span>
<span class="sd">        - JSON response indicating the status of the removal.</span>

<span class="sd">    Raises:</span>
<span class="sd">        - Exception: If an error occurs during the processing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Extract user and article IDs from the JSON data in the request body</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">)</span>
        <span class="n">article_id</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;article_id&#39;</span><span class="p">)</span>

        <span class="c1"># Check if the user has the article in favorites</span>
        <span class="k">if</span> <span class="n">UserFavorite</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span> <span class="n">article_id</span><span class="o">=</span><span class="n">article_id</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="c1"># If the article is in favorites, delete it</span>
            <span class="n">UserFavorite</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span> <span class="n">article_id</span><span class="o">=</span><span class="n">article_id</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;Removed from favorites&#39;</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;Not in favorites&#39;</span><span class="p">})</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># Return JSON response with an error message if an exception occurs</span>
        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)})</span></div>


<span class="c1">#--------------------------------------------------------------</span>
<div class="viewcode-block" id="get_favorite_articles">
<a class="viewcode-back" href="../../docs/app.html#app.views.get_favorite_articles">[docs]</a>
<span class="nd">@csrf_exempt</span>
<span class="k">def</span> <span class="nf">get_favorite_articles</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    View function to retrieve favorite articles for a user.</span>

<span class="sd">    Request:</span>
<span class="sd">        - POST request with JSON data containing &#39;user_id&#39;.</span>

<span class="sd">    Response:</span>
<span class="sd">        - JSON response with favorite article data.</span>

<span class="sd">    Raises:</span>
<span class="sd">        - Exception: If an error occurs during the processing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Retrieve JSON data from the request body</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
            <span class="n">user_id</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">)</span>

            <span class="c1"># Query UserFavorite model to get favorite article IDs</span>
            <span class="n">favorite_article_ids</span> <span class="o">=</span> <span class="n">UserFavorite</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s1">&#39;article_id&#39;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Use Elasticsearch to retrieve actual articles</span>
            <span class="k">if</span> <span class="n">favorite_article_ids</span><span class="p">:</span>
                <span class="c1"># Perform Elasticsearch search for favorite articles</span>
                <span class="n">query</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;terms&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">favorite_article_ids</span><span class="p">)}}</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Elasticsearch query: </span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">perform_elasticsearch_search</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

                <span class="c1"># Extract and format the articles</span>
                <span class="n">hits_data</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">hit</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                    <span class="c1"># Ensure &#39;validated&#39; is True</span>
                    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="s1">&#39;validated&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
                        <span class="n">title</span> <span class="o">=</span> <span class="n">hit</span><span class="o">.</span><span class="n">title</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
                        <span class="n">authors</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hit</span><span class="o">.</span><span class="n">authors</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="s1">&#39;authors&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="p">[])</span>
                        <span class="n">institutions</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hit</span><span class="o">.</span><span class="n">institutions</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="s1">&#39;institutions&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="p">[])</span>
                        <span class="n">keywords</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hit</span><span class="o">.</span><span class="n">keywords</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="s1">&#39;keywords&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="p">[])</span>
                        <span class="n">abstract</span> <span class="o">=</span> <span class="n">hit</span><span class="o">.</span><span class="n">abstract</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="s1">&#39;abstract&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
                        <span class="n">references</span> <span class="o">=</span> <span class="n">hit</span><span class="o">.</span><span class="n">references</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="s1">&#39;references&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
                        <span class="n">text</span> <span class="o">=</span> <span class="n">hit</span><span class="o">.</span><span class="n">text</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
                        <span class="n">date</span> <span class="o">=</span> <span class="n">hit</span><span class="o">.</span><span class="n">date</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;2024-10-12&#39;</span>
                        <span class="n">id2</span> <span class="o">=</span> <span class="n">hit</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">id</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">hit</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>

                        <span class="c1"># Append data to the list</span>
                        <span class="n">hits_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
                            <span class="s1">&#39;authors&#39;</span><span class="p">:</span> <span class="n">authors</span><span class="p">,</span>
                            <span class="s1">&#39;institutions&#39;</span><span class="p">:</span> <span class="n">institutions</span><span class="p">,</span>
                            <span class="s1">&#39;keywords&#39;</span><span class="p">:</span> <span class="n">keywords</span><span class="p">,</span>
                            <span class="s1">&#39;abstract&#39;</span><span class="p">:</span> <span class="n">abstract</span><span class="p">,</span>
                            <span class="s1">&#39;references&#39;</span><span class="p">:</span> <span class="n">references</span><span class="p">,</span>
                            <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="n">text</span><span class="p">,</span>
                            <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">date</span><span class="p">,</span>
                            <span class="s1">&#39;id2&#39;</span><span class="p">:</span> <span class="n">id2</span>
                        <span class="p">})</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Not validated&#39;</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s1">&#39;favorite_articles&#39;</span><span class="p">:</span> <span class="n">hits_data</span><span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;User has no favorite articles&#39;</span><span class="p">},</span> <span class="n">status</span><span class="o">=</span><span class="mi">404</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Error in get_favorite_articles: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">},</span> <span class="n">status</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;This view only accepts POST requests.&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="is_favorite">
<a class="viewcode-back" href="../../docs/app.html#app.views.is_favorite">[docs]</a>
<span class="nd">@csrf_exempt</span>
<span class="k">def</span> <span class="nf">is_favorite</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    View function to check if an article is marked as a favorite by a user.</span>

<span class="sd">    Request:</span>
<span class="sd">        - POST request with JSON data containing &#39;user_id&#39; and &#39;article_id&#39;.</span>

<span class="sd">    Response:</span>
<span class="sd">        - JSON response indicating whether the article is a favorite for the user.</span>

<span class="sd">    Raises:</span>
<span class="sd">        - Exception: If an error occurs during the processing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Extract user and article IDs from the JSON data in the request body</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">)</span>
        <span class="n">article_id</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;article_id&#39;</span><span class="p">)</span>

        <span class="c1"># Check if the user has the article in favorites</span>
        <span class="n">is_favorite</span> <span class="o">=</span> <span class="n">UserFavorite</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span> <span class="n">article_id</span><span class="o">=</span><span class="n">article_id</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>

        <span class="c1"># Return JSON response indicating whether the article is a favorite for the user</span>
        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s1">&#39;is_favorite&#39;</span><span class="p">:</span> <span class="n">is_favorite</span><span class="p">})</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># Return JSON response with an error message if an exception occurs</span>
        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)},</span> <span class="n">status</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="perform_elasticsearch_search">
<a class="viewcode-back" href="../../docs/app.html#app.views.perform_elasticsearch_search">[docs]</a>
<span class="k">def</span> <span class="nf">perform_elasticsearch_search</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performs an Elasticsearch search using the provided query.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        - query (str): The search query.</span>

<span class="sd">    Returns:</span>
<span class="sd">        - response: Elasticsearch search response.</span>

<span class="sd">    Raises:</span>
<span class="sd">        - Exception: If an error occurs during the Elasticsearch search.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Create an Elasticsearch search object and set the query</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">ArticleIndex</span><span class="o">.</span><span class="n">search</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

        <span class="c1"># Set the size of the result set to 30</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">extra</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

        <span class="c1"># Execute the Elasticsearch search</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

        <span class="c1"># Print the Elasticsearch response for debugging</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Elasticsearch response: </span><span class="si">{</span><span class="n">response</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">response</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># Print the Elasticsearch error if an exception occurs</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Elasticsearch error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span></div>


<span class="c1">#-------------------------------------------------------------- </span>

<div class="viewcode-block" id="create_and_index_random_articles">
<a class="viewcode-back" href="../../docs/app.html#app.views.create_and_index_random_articles">[docs]</a>
<span class="k">def</span> <span class="nf">create_and_index_random_articles</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to create and index random articles for testing purposes.</span>

<span class="sd">    This function generates dummy data for authors, institutions, keywords, and creates random articles.</span>

<span class="sd">    No parameters are required. The generated articles are indexed using the existing index_articles function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Dummy data for authors, institutions, keywords</span>
    <span class="n">authors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Author A&#39;</span><span class="p">,</span> <span class="s1">&#39;Author B&#39;</span><span class="p">,</span> <span class="s1">&#39;Author C&#39;</span><span class="p">]</span>
    <span class="n">institutions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Institution X&#39;</span><span class="p">,</span> <span class="s1">&#39;Institution Y&#39;</span><span class="p">,</span> <span class="s1">&#39;Institution Z&#39;</span><span class="p">]</span>
    <span class="n">keywords</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Keyword 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Keyword 2&#39;</span><span class="p">,</span> <span class="s1">&#39;Keyword 3&#39;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">):</span>
        <span class="c1"># Create a random article</span>
        <span class="n">article</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Random Article </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;abstract&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;This is the abstract of Random Article </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">,</span>
            <span class="s1">&#39;full_text&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;This is the full text of Random Article </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">,</span>
            <span class="s1">&#39;pdf_url&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;https://example.com/random-article-</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.pdf&#39;</span><span class="p">,</span>
            <span class="s1">&#39;authors&#39;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">authors</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">authors</span><span class="p">))),</span>
            <span class="s1">&#39;institutions&#39;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">institutions</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">institutions</span><span class="p">))),</span>
            <span class="s1">&#39;keywords&#39;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">keywords</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">keywords</span><span class="p">))),</span>
            <span class="s1">&#39;references&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;These are the references of Random Article </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># Set a default value for &#39;validated&#39; (you may adjust this based on your logic)</span>
        <span class="n">article</span><span class="p">[</span><span class="s1">&#39;validated&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Set a default value for &#39;date&#39; (you may adjust this based on your logic)</span>
        <span class="n">article</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

        <span class="c1"># Index the article using the existing index_articles function</span>
        <span class="n">index_articles</span><span class="p">(</span><span class="n">article</span><span class="p">)</span></div>


<div class="viewcode-block" id="index_article">
<a class="viewcode-back" href="../../docs/app.html#app.views.index_article">[docs]</a>
<span class="k">def</span> <span class="nf">index_article</span><span class="p">(</span><span class="n">article</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to index a single article in Elasticsearch.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        - article (dict): The article data.</span>
<span class="sd">        - i (int): The identifier for the article.</span>

<span class="sd">    Response:</span>
<span class="sd">        - JSON response indicating the status of the indexing.</span>

<span class="sd">    Raises:</span>
<span class="sd">        - Exception: If an error occurs during indexing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Initialize the ArticleIndex (you may adjust this based on your requirements)</span>
        <span class="n">ArticleIndex</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

        <span class="c1"># Define actions for bulk indexing</span>
        <span class="n">actions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;_op_type&quot;</span><span class="p">:</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span>
                <span class="s2">&quot;_index&quot;</span><span class="p">:</span> <span class="s2">&quot;article_index&quot;</span><span class="p">,</span>
                <span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span>
                <span class="s2">&quot;_source&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">article</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">],</span>
                    <span class="s2">&quot;abstract&quot;</span><span class="p">:</span> <span class="n">article</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">],</span>
                    <span class="s2">&quot;authors&quot;</span><span class="p">:</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">author</span><span class="p">)</span> <span class="k">for</span> <span class="n">author</span> <span class="ow">in</span> <span class="n">article</span><span class="p">[</span><span class="s1">&#39;authors&#39;</span><span class="p">]),</span>
                    <span class="s2">&quot;institutions&quot;</span><span class="p">:</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">institution</span><span class="p">)</span> <span class="k">for</span> <span class="n">institution</span> <span class="ow">in</span> <span class="n">article</span><span class="p">[</span><span class="s1">&#39;institutions&#39;</span><span class="p">]),</span>
                    <span class="s2">&quot;keywords&quot;</span><span class="p">:</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span> <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">article</span><span class="p">[</span><span class="s1">&#39;keywords&#39;</span><span class="p">]),</span>
                    <span class="s2">&quot;references&quot;</span><span class="p">:</span> <span class="n">article</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">],</span>
                    <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">article</span><span class="p">[</span><span class="s1">&#39;full_text&#39;</span><span class="p">],</span>
                    <span class="s2">&quot;pdf_url&quot;</span><span class="p">:</span> <span class="n">article</span><span class="p">[</span><span class="s1">&#39;pdf_url&#39;</span><span class="p">],</span>
                    <span class="s2">&quot;validated&quot;</span><span class="p">:</span> <span class="n">article</span><span class="p">[</span><span class="s1">&#39;validated&#39;</span><span class="p">],</span>
                    <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="n">article</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">]</span>

        <span class="c1"># Get Elasticsearch connection and perform bulk indexing</span>
        <span class="n">es</span> <span class="o">=</span> <span class="n">ArticleIndex</span><span class="o">.</span><span class="n">_get_connection</span><span class="p">()</span>
        <span class="n">success</span><span class="p">,</span> <span class="n">failed</span> <span class="o">=</span> <span class="n">bulk</span><span class="p">(</span><span class="n">client</span><span class="o">=</span><span class="n">es</span><span class="p">,</span> <span class="n">actions</span><span class="o">=</span><span class="n">actions</span><span class="p">,</span> <span class="n">stats_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Print success or failure message</span>
        <span class="k">if</span> <span class="n">failed</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to index article: </span><span class="si">{</span><span class="n">failed</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Article indexed successfully&quot;</span><span class="p">)</span>

        <span class="c1"># Return JSON response based on indexing success or failure</span>
        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Article indexed successfully&#39;</span><span class="p">})</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># Print error message and return JSON response with an error message</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during indexing: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Error during indexing: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">})</span></div>


<span class="c1">#--------------------------------------------------------------</span>

<div class="viewcode-block" id="modify_article">
<a class="viewcode-back" href="../../docs/app.html#app.views.modify_article">[docs]</a>
<span class="nd">@csrf_exempt</span>
<span class="k">def</span> <span class="nf">modify_article</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    View function to modify/update an article in Elasticsearch.</span>

<span class="sd">    Request:</span>
<span class="sd">        - POST request with JSON data containing &#39;article_id&#39; and optional fields for modification.</span>

<span class="sd">    Response:</span>
<span class="sd">        - JSON response indicating the status of the modification.</span>

<span class="sd">    Raises:</span>
<span class="sd">        - Exception: If an error occurs during the modification.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Extract user and article IDs from the JSON data in the request body</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
        <span class="n">article_id</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;article_id&#39;</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;abstract&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">authors</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;authors&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">institutions</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;institutions&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">keywords</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;keywords&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">references</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;references&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">full_text</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;full_text&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">pdf_url</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pdf_url&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">validated</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Set a default value for &#39;validated&#39; (you may adjust this based on your logic)</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>   <span class="c1"># Set a default value for &#39;date&#39; (you may adjust this based on your logic)</span>

        <span class="c1"># Create an Elasticsearch client</span>
        <span class="n">es</span> <span class="o">=</span> <span class="n">connections</span><span class="o">.</span><span class="n">get_connection</span><span class="p">()</span>

        <span class="c1"># Update the article in Elasticsearch</span>
        <span class="n">es</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;article_index&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">article_id</span><span class="p">,</span>
                  <span class="n">body</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;doc&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
                    <span class="s1">&#39;abstract&#39;</span><span class="p">:</span> <span class="n">abstract</span><span class="p">,</span>
                    <span class="s1">&#39;authors&#39;</span><span class="p">:</span> <span class="n">authors</span><span class="p">,</span>
                    <span class="s1">&#39;institutions&#39;</span><span class="p">:</span> <span class="n">institutions</span><span class="p">,</span>
                    <span class="s1">&#39;keywords&#39;</span><span class="p">:</span> <span class="n">keywords</span><span class="p">,</span>
                    <span class="s1">&#39;references&#39;</span><span class="p">:</span> <span class="n">references</span><span class="p">,</span>
                    <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="n">full_text</span><span class="p">,</span>
                    <span class="s1">&#39;pdf_url&#39;</span><span class="p">:</span> <span class="n">pdf_url</span><span class="p">,</span>
                    <span class="s1">&#39;validated&#39;</span><span class="p">:</span> <span class="n">validated</span><span class="p">,</span>
                    <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">date</span>
                  <span class="p">}})</span>

        <span class="c1"># Return JSON response indicating the success of the modification</span>
        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Article updated successfully&#39;</span><span class="p">})</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># Print error message and return JSON response with an error message</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in modify_article: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Error in modify_article: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">},</span> <span class="n">status</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span></div>


<span class="c1">#--------------------------------------------------------------</span>

<div class="viewcode-block" id="create_and_index_random_articles2">
<a class="viewcode-back" href="../../docs/app.html#app.views.create_and_index_random_articles2">[docs]</a>
<span class="k">def</span> <span class="nf">create_and_index_random_articles2</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to create and index additional random articles with validated = True for testing purposes.</span>

<span class="sd">    This function generates dummy data for authors, institutions, keywords, and creates random articles.</span>

<span class="sd">    No parameters are required. The generated articles are indexed using the existing index_article function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Dummy data for authors, institutions, keywords</span>
    <span class="n">authors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Author A&#39;</span><span class="p">,</span> <span class="s1">&#39;Author B&#39;</span><span class="p">,</span> <span class="s1">&#39;Author C&#39;</span><span class="p">]</span>
    <span class="n">institutions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Institution X&#39;</span><span class="p">,</span> <span class="s1">&#39;Institution Y&#39;</span><span class="p">,</span> <span class="s1">&#39;Institution Z&#39;</span><span class="p">]</span>
    <span class="n">keywords</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Keyword 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Keyword 2&#39;</span><span class="p">,</span> <span class="s1">&#39;Keyword 3&#39;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">):</span>
        <span class="c1"># Create a random article</span>
        <span class="n">article</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Random Article </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;abstract&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;This is the abstract of Random Article </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">,</span>
            <span class="s1">&#39;full_text&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;This is the full text of Random Article </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">,</span>
            <span class="s1">&#39;pdf_url&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;https://example.com/random-article-</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.pdf&#39;</span><span class="p">,</span>
            <span class="s1">&#39;authors&#39;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">authors</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">authors</span><span class="p">))),</span>
            <span class="s1">&#39;institutions&#39;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">institutions</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">institutions</span><span class="p">))),</span>
            <span class="s1">&#39;keywords&#39;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">keywords</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">keywords</span><span class="p">))),</span>
            <span class="s1">&#39;references&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;These are the references of Random Article </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># Set a default value for &#39;validated&#39; (you may adjust this based on your logic)</span>
        <span class="n">article</span><span class="p">[</span><span class="s1">&#39;validated&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Set a default value for &#39;date&#39; (you may adjust this based on your logic)</span>
        <span class="n">article</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

        <span class="c1"># Index the article using the existing index_article function</span>
        <span class="n">index_article</span><span class="p">(</span><span class="n">article</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span></div>


<span class="c1">#-----------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="not_validated">
<a class="viewcode-back" href="../../docs/app.html#app.views.not_validated">[docs]</a>
<span class="k">def</span> <span class="nf">not_validated</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    View function to retrieve and display articles that are not validated.</span>

<span class="sd">    Request:</span>
<span class="sd">        - GET request to perform Elasticsearch search.</span>

<span class="sd">    Response:</span>
<span class="sd">        - JSON response containing information about not validated articles.</span>

<span class="sd">    Raises:</span>
<span class="sd">        - Exception: If an error occurs during the search.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Perform Elasticsearch search with retry mechanism for not validated articles</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">perform_elasticsearch_search_not_validated</span><span class="p">()</span>

        <span class="n">hits_data</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Move the list declaration outside the loop</span>

        <span class="c1"># Extract and print search results in the console</span>
        <span class="k">for</span> <span class="n">hit</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">hit</span><span class="o">.</span><span class="n">title</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
            <span class="n">authors</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hit</span><span class="o">.</span><span class="n">authors</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="s1">&#39;authors&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="p">[])</span>
            <span class="n">institutions</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hit</span><span class="o">.</span><span class="n">institutions</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="s1">&#39;institutions&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="p">[])</span>
            <span class="n">keywords</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hit</span><span class="o">.</span><span class="n">keywords</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="s1">&#39;keywords&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="p">[])</span>
            <span class="n">abstract</span> <span class="o">=</span> <span class="n">hit</span><span class="o">.</span><span class="n">abstract</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="s1">&#39;abstract&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
            <span class="n">references</span> <span class="o">=</span> <span class="n">hit</span><span class="o">.</span><span class="n">references</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="s1">&#39;references&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">hit</span><span class="o">.</span><span class="n">text</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
            <span class="n">date</span> <span class="o">=</span> <span class="n">hit</span><span class="o">.</span><span class="n">date</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;2024-10-12&#39;</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="n">hit</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">id</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="s1">&#39;meta&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">hit</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
            <span class="n">pdf_url</span> <span class="o">=</span> <span class="n">hit</span><span class="o">.</span><span class="n">pdf_url</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="s1">&#39;pdf_url&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>

            <span class="c1"># Print information to the console</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Title: </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Authors: </span><span class="si">{</span><span class="n">authors</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Institutions: </span><span class="si">{</span><span class="n">institutions</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Keywords: </span><span class="si">{</span><span class="n">keywords</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Abstract: </span><span class="si">{</span><span class="n">abstract</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;References: </span><span class="si">{</span><span class="n">references</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Text: </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Date: </span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ID: </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PDF URL: </span><span class="si">{</span><span class="n">pdf_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Append data to the list</span>
            <span class="n">hits_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
                <span class="s1">&#39;authors&#39;</span><span class="p">:</span> <span class="n">authors</span><span class="p">,</span>
                <span class="s1">&#39;institutions&#39;</span><span class="p">:</span> <span class="n">institutions</span><span class="p">,</span>
                <span class="s1">&#39;keywords&#39;</span><span class="p">:</span> <span class="n">keywords</span><span class="p">,</span>
                <span class="s1">&#39;abstract&#39;</span><span class="p">:</span> <span class="n">abstract</span><span class="p">,</span>
                <span class="s1">&#39;references&#39;</span><span class="p">:</span> <span class="n">references</span><span class="p">,</span>
                <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="n">text</span><span class="p">,</span>
                <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">date</span><span class="p">,</span>
                <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="nb">id</span><span class="p">,</span>
                <span class="s1">&#39;pdf_url&#39;</span><span class="p">:</span> <span class="n">pdf_url</span>
            <span class="p">})</span>

        <span class="c1"># Return JSON response containing information about not validated articles</span>
        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s1">&#39;result&#39;</span><span class="p">:</span> <span class="n">hits_data</span><span class="p">})</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># Return JSON response with an error message if an exception occurs</span>
        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Error during research: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">})</span></div>


<div class="viewcode-block" id="perform_elasticsearch_search_not_validated">
<a class="viewcode-back" href="../../docs/app.html#app.views.perform_elasticsearch_search_not_validated">[docs]</a>
<span class="nd">@retry</span><span class="p">(</span><span class="n">stop</span><span class="o">=</span><span class="n">stop_after_delay</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span> <span class="n">wait</span><span class="o">=</span><span class="n">wait_fixed</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">perform_elasticsearch_search_not_validated</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to perform an Elasticsearch search for articles that are not validated.</span>

<span class="sd">    Uses the @retry decorator to handle retries in case of Elasticsearch search failure.</span>

<span class="sd">    Returns:</span>
<span class="sd">        - Elasticsearch response containing information about not validated articles.</span>

<span class="sd">    Raises:</span>
<span class="sd">        - Exception: If the Elasticsearch search fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Assuming you have a Search object</span>
        <span class="n">search</span> <span class="o">=</span> <span class="n">Search</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;article_index&#39;</span><span class="p">)</span>

        <span class="c1"># Build the query to match documents where &#39;validated&#39; is false</span>
        <span class="n">search</span> <span class="o">=</span> <span class="n">search</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;match&#39;</span><span class="p">,</span> <span class="n">validated</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Set the size for the number of documents to retrieve</span>
        <span class="n">search</span> <span class="o">=</span> <span class="n">search</span><span class="o">.</span><span class="n">extra</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

        <span class="c1"># Execute the Elasticsearch search</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">search</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

        <span class="c1"># Check if the search was successful</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">success</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">response</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Raise an exception if the search was not successful</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Elasticsearch search failed&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># Raise an exception if an error occurs during the Elasticsearch search</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Elasticsearch error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<span class="c1">#--------------------------------------------------------</span>
    
<div class="viewcode-block" id="delete_article">
<a class="viewcode-back" href="../../docs/app.html#app.views.delete_article">[docs]</a>
<span class="nd">@csrf_exempt</span>
<span class="k">def</span> <span class="nf">delete_article</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    View function to delete an article from Elasticsearch.</span>

<span class="sd">    Request:</span>
<span class="sd">        - POST request with article ID in the request body.</span>

<span class="sd">    Response:</span>
<span class="sd">        - JSON response indicating the success or failure of the deletion operation.</span>

<span class="sd">    Raises:</span>
<span class="sd">        - Exception: If an error occurs during the deletion operation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Extract article ID from the request body</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
        <span class="n">article_id</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;article_id&#39;</span><span class="p">)</span>

        <span class="c1"># Create an Elasticsearch client</span>
        <span class="n">es</span> <span class="o">=</span> <span class="n">connections</span><span class="o">.</span><span class="n">get_connection</span><span class="p">()</span>

        <span class="c1"># Use the delete_by_query API to delete the article</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">es</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;article_index&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">article_id</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="c1"># Check if the delete operation was successful</span>
        <span class="k">if</span> <span class="s1">&#39;result&#39;</span> <span class="ow">in</span> <span class="n">result</span> <span class="ow">and</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;deleted&#39;</span><span class="p">:</span>
            <span class="c1"># Return success response if the article was deleted</span>
            <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Article deleted successfully&#39;</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Return error response if the article was not found or deletion failed</span>
            <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Article not found or deletion failed&#39;</span><span class="p">},</span> <span class="n">status</span><span class="o">=</span><span class="mi">404</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># Print error message to console and return error response</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in delete_article: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Error in delete_article: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">},</span> <span class="n">status</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span></div>




</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">SciQuest</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Dinari Yasmine.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
    </div>

    

    
  </body>
</html>